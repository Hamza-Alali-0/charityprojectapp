<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord - Organisation</title>
    <link rel="stylesheet" th:href="@{/styles/dashboard.css}">
    <!-- Adding Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

</head>
<body th:data-password-error="${passwordError}" th:data-profile-error="${profileError}">
<!-- Main Navigation Bar -->
<nav class="navbar">
    <div class="navbar-left">
        <div class="logo-circle">
            <img th:if="${organisation.logo}" th:src="'data:image/png;base64,' + ${organisation.logo}" alt="Logo de l'organisation">
            <img th:unless="${organisation.logo}" src="https://via.placeholder.com/40" alt="Logo par défaut">
        </div>
        <div class="org-name" th:text="${organisation.nom}">Nom de l'Organisation</div>
    </div>

    <div class="navbar-right">
        <span class="id-info" th:text="'ID: ' + ${organisation.numeroIdentif}">ID: 123456</span>

        <!-- Notification Bell -->
        <div class="notification">
            <a href="#" class="notification-icon">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </a>
        </div>

        <div class="dropdown">
            <a href="#" class="param-icon" id="dropdownToggle"><i class="fas fa-cog"></i></a>
            <div class="dropdown-content">
                <a href="#" class="dropdown-item" id="showProfileModal"><i class="fas fa-user-edit"></i> Modifier profil</a>
                <a href="#" class="dropdown-item"><i class="fas fa-language"></i> Langue</a>
                <a href="/logout" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> Déconnexion</a>
            </div>
        </div>
    </div>
</nav>

<!-- Sub Navigation with Rectangles -->
<div class="sub-navbar">
    <a href="#section1" class="sub-nav-item">
        <i class="fas fa-chart-line"></i>
        <span>Tableau de bord</span>
    </a>
    <a href="#section2" class="sub-nav-item">
        <i class="fas fa-tasks"></i>
        <span>Lancer des Actions</span>
    </a>
    <a href="#section3" class="sub-nav-item">
        <i class="fas fa-users"></i>
        <span>Actions Archivees</span>
    </a>
</div>

<!-- Profile Modal -->
<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>

        <!-- Profile View -->
        <div id="profileView">
            <div class="profile-header">
                <h2>Profil de l'Organisation</h2>
                <div class="profile-actions">
                    <button id="modifyBtn" class="action-btn"><i class="fas fa-edit"></i> Modifier</button>
                    <button id="passwordBtn" class="action-btn"><i class="fas fa-key"></i> Modifier mot de passe</button>
                </div>
            </div>

            <div class="profile-body">
                <div class="profile-logo">
                    <img th:if="${organisation.logo}" th:src="'data:image/png;base64,' + ${organisation.logo}" alt="Logo de l'organisation">
                    <img th:unless="${organisation.logo}" src="https://via.placeholder.com/200" alt="Logo par défaut">
                </div>

                <div class="profile-details">
                    <div class="detail-item">
                        <span class="label">Nom:</span>
                        <span class="value" th:text="${organisation.nom}">Nom de l'Organisation</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Numéro d'identification:</span>
                        <span class="value" th:text="${organisation.numeroIdentif}">123456</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Adresse légale:</span>
                        <span class="value" th:text="${organisation.adresseLegale}">Adresse de l'organisation</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Description:</span>
                        <span class="value description" th:text="${organisation.description}">Description de l'organisation...</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Contact Principal:</span>
                        <span class="value " th:text="${organisation.contactPrincipal}">Contact Principal</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Profile Form -->
        <div id="editProfileForm" style="display: none;">
            <div class="profile-header">
                <h2>Modifier le Profil</h2>
            </div>

            <!-- Error message display -->
            <div th:if="${profileErrorMessage}" class="alert alert-danger" role="alert"
                 th:text="${profileErrorMessage}" style="color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; padding: 0.75rem 1.25rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: 0.25rem;">
            </div>

            <form id="orgProfileForm" th:action="@{/organisation/update-profile}" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="orgName">Nom de l'Organisation</label>
                    <input type="text" id="orgName" name="nom" th:value="${organisation.nom}" required
                           th:class="${profileError == 'name-invalid'} ? 'is-invalid' : ''"
                           style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ced4da;">
                    <div th:if="${profileError == 'name-invalid'}"
                         style="color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;">
                        Le nom de l'organisation est obligatoire.
                    </div>
                </div>

                <div class="form-group">
                    <label for="orgId">Numéro d'identification</label>
                    <input type="text" id="orgId" name="numeroIdentif" th:value="${organisation.numeroIdentif}" required
                           th:class="${profileError == 'id-empty' || profileError == 'id-exists'} ? 'is-invalid' : ''"
                           style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ced4da;">
                    <div th:if="${profileError == 'id-empty'}"
                         style="color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;">
                        Le numéro d'identification est obligatoire.
                    </div>
                    <div th:if="${profileError == 'id-exists'}"
                         style="color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;">
                        Ce numéro d'identification est déjà utilisé.
                    </div>
                </div>

                <div class="form-group">
                    <label for="orgAddress">Adresse légale</label>
                    <input type="text" id="orgAddress" name="adresseLegale" th:value="${organisation.adresseLegale}" required
                           th:class="${profileError == 'address-invalid'} ? 'is-invalid' : ''"
                           style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ced4da;">
                    <div th:if="${profileError == 'address-invalid'}"
                         style="color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;">
                        L'adresse légale est obligatoire.
                    </div>
                </div>

                <div class="form-group">
                    <label for="orgDescription">Description</label>
                    <textarea id="orgDescription" name="description" rows="4" th:text="${organisation.description}" required
                              th:class="${profileError == 'description-invalid'} ? 'is-invalid' : ''"
                              style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ced4da;"></textarea>
                    <div th:if="${profileError == 'description-invalid'}"
                         style="color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;">
                        La description est obligatoire.
                    </div>
                </div>

                <div class="form-group">
                    <label for="contactPrincipal">Contact Principal</label>
                    <input type="text" id="contactPrincipal" name="contactprincipal" th:value="${organisation.contactPrincipal}" required
                           th:class="${profileError == 'contact-invalid'} ? 'is-invalid' : ''"
                           style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ced4da;">
                    <div th:if="${profileError == 'contact-invalid'}"
                         style="color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;">
                        Le contact principal est obligatoire.
                    </div>
                </div>

                <div class="form-group">
                    <label for="orgLogo">Logo</label>
                    <div class="logo-upload">
                        <div class="current-logo" style="width: 200px; height: 200px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                            <img th:if="${organisation.logo}" th:src="'data:image/png;base64,' + ${organisation.logo}" alt="Logo actuel" style="width: 100%; height: 100%; object-fit: contain;">
                            <img th:unless="${organisation.logo}" src="https://via.placeholder.com/200" alt="Logo par défaut" style="width: 100%; height: 100%; object-fit: contain;">
                        </div>
                        <input type="file" id="orgLogo" name="logoFile" accept="image/*"
                               th:class="${profileError == 'logo-invalid'} ? 'is-invalid' : ''">
                        <div th:if="${profileError == 'logo-invalid'}"
                             style="color: #dc3545; font-size: 0.875em; margin-top: 0.25rem;">
                            Le format ou la taille du logo est invalide.
                        </div>
                        <p class="file-hint" style="color: #666; font-size: 0.85em; margin-top: 5px;">Formats acceptés: JPG, PNG. Taille max: 2MB</p>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-btn"><i class="fas fa-save"></i> Enregistrer</button>
                    <button type="button" id="cancelEditBtn" class="cancel-btn"><i class="fas fa-times"></i> Annuler</button>
                </div>
            </form>
        </div>
        <!-- Password Form -->
        <div id="passwordForm" style="display: none;">
            <div class="profile-header">
                <h2>Modifier le Mot de Passe</h2>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger" role="alert"
                 th:text="${errorMessage}">
            </div>
            <form id="changePasswordForm" th:action="@{/organisation/change-password}" method="post">
                <div class="form-group">
                    <label for="currentPassword">Mot de passe actuel</label>
                    <input type="password" id="currentPassword" name="currentPassword" required>
                </div>

                <div class="form-group">
                    <label for="newPassword">Nouveau mot de passe</label>
                    <input type="password" id="newPassword" name="newPassword" required>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirmer le mot de passe</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-btn"><i class="fas fa-key"></i> Modifier mot de passe</button>
                    <button type="button" id="cancelPasswordBtn" class="cancel-btn"><i class="fas fa-times"></i> Annuler</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/js/dashboard.js}"></script>
</body>
</html>